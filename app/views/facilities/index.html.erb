<div id="facilities" style="margin-top:45px; height:100%; width:100%;">
  <div class="row">
    <div class="large-9 push-3 columns" style="margin-top:20px">
      <h3>Open Therapist Directory<small> Mental Health Resource Finder</small></h3>
      <ul class="filter" style="margin-bottom:0px">
        <li class="btn" id="filter-none">Show all</li>
        <p style="display:inline-block">State:</p>
        <form action="" style="display:inline-block">
          <select name="filter-state" id="filter-state">
            <option value=""> </option>
            <% @states.each do |state| %>
              <option value="<%=state%>"><%=state%></option>
            <% end %>
          </select>
        </form>
        <small style="float:right ">Click on the plus icon to add the location to the map.</small>
      </ul>
      <ul class="list" style="padding-top:0px">
      </ul>
    </div>
    <div class="large-3 pull-9 columns">
      <ul class="side-nav">
      <h1><%= image_tag "otdlogo.png"%></h1>
        <li><input class="search" placeholder="Search All Fields" /></li>
        <li><span class="sort" data-sort="name">Sort by Name</span></li>
        <li><span class="sort" data-sort="city">Sort by City</span></li>
        <div id="map-canvas" style="width:240px; height:240px;"></div>
      </ul>
    </div>
  </div>
</div>

<script>
  var facilities = <%= @facilities %>
  var firstFacilities   = _.first(facilities, 20);
  var currentFacilities = firstFacilities;

  _.each(firstFacilities, render);

  var geocoder = new google.maps.Geocoder();

  var initialLocation = navigator.geolocation.getCurrentPosition(function (position) {
       initialLocation = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
       map.setCenter(initialLocation);

       var marker = new google.maps.Marker({
          position: initialLocation,
          title: 'Your Location',
          draggable: false,
          map: map
      });

      map.setCenter(marker.getPosition());
  });

  var mapOptions = {
    center: initialLocation,
    zoom: 12
  };

  var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

  google.maps.event.addDomListener(window, 'load');

  function addMarker(address) {
    geocoder.geocode( { 'address': address}, function(results, status) {
      if (status == google.maps.GeocoderStatus.OK) {
        map.setCenter(results[0].geometry.location);
        var marker = new google.maps.Marker({
            map: map,
            position: results[0].geometry.location
        });
        marker.setIcon('http://maps.google.com/mapfiles/ms/icons/blue-dot.png')
      } else {
        alert('Geocode was not successful for the following reason: ' + status);
      }
    });
  }
  // $(".pagination").quickPagination({pageSize:"3"});
</script>

<script src="/assets/listing.js"></script>
<script src="/assets/maps.js"></script>
